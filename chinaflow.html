<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>中国人流迁徙图</title>
    <!-- 引入 ECharts 和中国地图 -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>
    <!-- 引入数据-->
    <script src="data.js"></script>
</head>
<body style="margin:0">
    <!-- 选择项 -->
    <div style="
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background: #ffffff;
        padding: 12px 16px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 14px;
        color: #333;
        display: flex;
        align-items: center;
        gap: 10px;
    ">

        <label>起点：</label>
        <select id="fromSelect" style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;"></select>

        <label>终点：</label>
        <select id="toSelect" style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;"></select>

        <button onclick="filterData()" style="
            padding: 6px 12px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        ">确定</button>
    </div>

    <div id="main" style="width: 100vw; height: 100vh;"></div>

    <script type="text/javascript">
        var chart = echarts.init(document.getElementById('main'));

        // 转换为 ECharts lines 数据格式
        var convertData = function (data) {
            var res = [];
            for (var i = 0; i < data.length; i++) {
                var fromCoord = geoCoordMap[data[i].from];
                var toCoord = geoCoordMap[data[i].to];
                if (fromCoord && toCoord) {
                    res.push({
                        fromName: data[i].from,
                        toName: data[i].to,
                        coords: [fromCoord, toCoord],
                        value: data[i].value
                    });
                }
            }
            return res;
        };

        // 页面加载时填充起点终点城市
        window.onload = function() {
            var fromSel = document.getElementById("fromSelect");
            var toSel = document.getElementById("toSelect");
            for (var city in geoCoordMap) {
                fromSel.innerHTML += '<option value="'+city+'">'+city+'</option>';
                toSel.innerHTML += '<option value="'+city+'">'+city+'</option>';
            }
        };

        // 配置项
        var option = {
            backgroundColor: '#FFFFFF',
            tooltip: {
                trigger: 'item',
                formatter: function (params) {
                    if (params.seriesType === "lines") {
                        return params.data.fromName + " → " + params.data.toName + " : " + params.data.value;
                    } else {
                        return params.name;
                    }
                }
            },
            geo: {
                map: 'china',
                roam: true,
                itemStyle: {
                    normal: {
                        areaColor: '#C8E6E0',
                        borderColor: '#111'
                    },
                    emphasis: {
                        areaColor: '#A5D0DD'
                    }
                }
            },
            // 视觉映射（分段图例）
            visualMap: {
                type: 'piecewise',
                min: 0,
                max: 10000000,
                pieces: [
                    {min: 10000000, label: '> 1000万', color: '#800026'},
                    {min: 1000000, max: 9999999, label: '100万-1000万', color: '#BD0026'},
                    {min: 100000, max: 999999, label: '10万-100万', color: '#E31A1C'},
                    {min: 10000, max: 99999, label: '1万-10万', color: '#FC4E2A'},
                    {min: 0, max: 9999, label: '0-1万', color: '#FD8D3C'}
                ],
                orient: 'vertical',
                right: 20,
                bottom: 30,
                textStyle: {
                    color: '#000'
                }
            },
            series: [
                {
                    name: '人流量',
                    type: 'lines',
                    coordinateSystem: 'geo',
                    zlevel: 2,
                    effect: {
                        show: true,
                        period: 4,
                        trailLength: 0.2,
                        symbol: 'arrow',
                        symbolSize: 10
                    },
                    lineStyle: {
                        color: '#d73027',
                        width: 2,
                        opacity: 0.8,
                        curveness: 0.2
                    },
                    data: []
                }
            ]
        };

        chart.setOption(option);

        // 筛选方法
        function filterData() {
            var from = document.getElementById("fromSelect").value;
            var to = document.getElementById("toSelect").value;
            var filteredData = moveData.filter(function(item) {
                return item.from === from && item.to === to;
            });
            option.series[0].data = convertData(filteredData);
            chart.setOption(option);
        }

    </script>
</body>
</html>
